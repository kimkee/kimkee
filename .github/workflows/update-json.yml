name: Update Alternating Commit Intensity
# name: Update Commit ${{ github.event.created_at || github.event.schedule || github.run_number }}
# name: Update Commit 2024-06-10 04:00:00 
# 일정에 따라 JSON 파일을 업데이트하고 커밋하는 워크플로우
# 매일 두 번 실행: 09:00 KST 및 13:00 KST
# 짝수일에는 5~10회 커밋, 홀수일에는 1회 커밋
# 커밋 메시지에 KST 시간과 모드(DARK 또는 LIGHT) 포함
# 기준일은 2025-01-01로 설정
# GitHub Secrets에 PERSONAL_TOKEN 설정 필요
# 커밋 작성자 정보는 "kimkee"와 "kimkee7@gmail.com"
# JSON 파일은 "update.json"으로 지정
# 커밋 간 2초 대기
# 푸시 대상 브랜치는 main
# GitHub Actions의 ubuntu-latest 환경에서 실행
# 커밋 패턴은 기준일부터의 날짜 차이에 따라 결정
# 짝수일: DARK 모드, 5~10회 커밋
# 홀수일: LIGHT 모드, 1회 커밋
# 커밋 메시지 형식: "Update.json on {KST 시간} ({모드} {현재 커밋 수}/{총 커밋 수})"
# JSON 파일 내용 형식: {"data": "{KST 시간}-{커밋 번호}"}
# 워크플로우 수동 실행도 가능
# GitHub Actions의 checkout 액션 사용
# 커밋 시각은 KST 기준으로 설정
# 커밋 수는 랜덤으로 결정 (짝수일: 5~10, 홀수일: 1)
on:
  schedule:
    - cron: "0 0 * * *"    # 09:00 KST
    - cron: "0 4 * * *"    # 13:00 KST
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Alternating commit pattern
        env:
          TOKEN: ${{ secrets.PERSONAL_TOKEN }}
        run: |
          git config user.name "kimkee"
          git config user.email "kimkee7@gmail.com"

          DAYCODE=$(TZ=Asia/Seoul date +%Y%m%d)
          KST_TIME=$(TZ=Asia/Seoul date +"%Y-%m-%d %H:%M:%S")

          # 기준일: 2025-01-01
          BASE_DATE="2025-01-01"
          TODAY=$(TZ=Asia/Seoul date +%Y-%m-%d)

          # 기준일부터 오늘까지의 날짜 차이 계산
          DAYS_SINCE=$(($(date -d "$TODAY" +%s) / 86400 - $(date -d "$BASE_DATE" +%s) / 86400))

          if [ $((DAYS_SINCE % 2)) -eq 0 ]; then
            COMMITS=$(( ( RANDOM % 6 ) + 5 ))
            MODE="DARK"
          else
            COMMITS=1
            MODE="LIGHT"
          fi


          echo "[$MODE mode] $COMMITS commits scheduled for ${KST_TIME}"

          for i in $(seq 1 $COMMITS); do
            echo "{\"data\": \"${KST_TIME}-${i}\"}" > update.json
            git add update.json
            git commit -m "Update.json on ${KST_TIME} (${MODE} ${i}/${COMMITS})"
            sleep 2
          done

          git push https://$TOKEN@github.com/kimkee/kimkee.git HEAD:main
