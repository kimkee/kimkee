name: Update Alternating Commit Intensity

on:
  schedule:
    - cron: "0 0 * * *"    # 09:00 KST
    - cron: "0 6 * * *"    # 15:00 KST
    - cron: "0 12 * * *"   # 21:00 KST
    - cron: "0 18 * * *"   # 03:00 KST (다음날)
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Alternating commit pattern
        env:
          TOKEN: ${{ secrets.PERSONAL_TOKEN }}
        run: |
          git config user.name "kimkee"
          git config user.email "kimkee7@gmail.com"

          DAYCODE=$(TZ=Asia/Seoul date +%Y%m%d)
          KST_TIME=$(TZ=Asia/Seoul date +"%Y-%m-%d-%H-%M-%S")

          # 기준일: 2025-01-01
          BASE_DATE="2025-01-01"
          TODAY=$(TZ=Asia/Seoul date +%Y-%m-%d)

          # 기준일부터 오늘까지의 날짜 차이 계산
          DAYS_SINCE=$(($(date -d "$TODAY" +%s) / 86400 - $(date -d "$BASE_DATE" +%s) / 86400))

          if [ $((DAYS_SINCE % 2)) -eq 0 ]; then
            COMMITS=$(( ( RANDOM % 6 ) + 15 ))
            MODE="DARK"
          else
            COMMITS=1
            MODE="LIGHT"
          fi


          echo "[$MODE mode] $COMMITS commits scheduled for ${KST_TIME}"

          for i in $(seq 1 $COMMITS); do
            echo "{\"data\": \"${KST_TIME}-${i}\"}" > update.json
            git add update.json
            git commit -m "Update.json on ${KST_TIME} (${MODE} ${i}/${COMMITS})"
            sleep 2
          done

          git push https://$TOKEN@github.com/kimkee/kimkee.git HEAD:main
