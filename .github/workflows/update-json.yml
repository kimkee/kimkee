name: Alternating Commit Intensity (Light/Dark Pattern)

on:
  schedule:
    - cron: "0 0 * * *"    # 09:00 KST
    - cron: "0 6 * * *"    # 15:00 KST
    - cron: "0 12 * * *"   # 21:00 KST
    - cron: "0 18 * * *"   # 03:00 KST (다음날)
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Alternating commit pattern
        env:
          TOKEN: ${{ secrets.PERSONAL_TOKEN }}
        run: |
          git config user.name "kimkee"
          git config user.email "kimkee7@gmail.com"

          DAYCODE=$(TZ=Asia/Seoul date +%Y%m%d)
          KST_TIME=$(TZ=Asia/Seoul date +"%Y-%m-%d-%H-%M-%S")

          # 날짜 기반 번갈이 패턴 (홀수: 1회 / 짝수: 15~20회)
          if [ $((10#$DAYCODE % 2)) -eq 0 ]; then
            COMMITS=$(( ( RANDOM % 6 ) + 15 ))   # 짝수날 - 15~20 랜덤
            MODE="DARK"
          else
            COMMITS=1                            # 홀수날 - 1회
            MODE="LIGHT"
          fi

          echo "[$MODE mode] $COMMITS commits scheduled for ${KST_TIME}"

          for i in $(seq 1 $COMMITS); do
            echo "{\"data\": \"${KST_TIME}-${i}\"}" > update.json
            git add update.json
            git commit -m "Update.json on ${KST_TIME} (${MODE} ${i}/${COMMITS})"
            sleep 2
          done

          git push https://$TOKEN@github.com/kimkee/kimkee.git HEAD:main
